---
title: "Tutorial 7 Lesson 2"
output: html_notebook
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)  # TODO: double-check what this does
library(ggplot2)

# Simulate some data (if include=FALSE does what I think, then this won't show)
x <- runif(n=100, min=0, max=10)
epsilon1 <- rnorm(n=20, mean=0, sd=0.01)
epsilon2 <- rnorm(n=80, mean=0, sd=5)
epsilon <- c(epsilon1, epsilon2)
y <- 2*x**2 + epsilon 

data <- data.frame(x,y)
# TODO: help with generating data that looks like IMS nonlinear supp (left)
```


# Exercise 0: Variable Exploration
(a) Create a scatterplot of x and y. Is the relationship between the two 
variables linear?
(b) Create histograms for the values of x and y. How would you describe these?
```{r}
```

Solution:
```{r}
ggplot(data=data, aes(x=x, y=y)) +
  geom_point()

ggplot(data=data, aes(x=x)) +
  geom_histogram()

ggplot(data=data, aes(x=y)) +
  geom_histogram()
```
(a) The relationship between y and x is not linear.
(b) The histogram for x looks slightly left skewed, whereas the histogram for
y looks very right skewed.


# Exercise 1: Transformation and Modeling
(a) Compute y* = log(y) and add it to the dataframe
(b) Plot the relationship between y* and x
(c) Fit a linear model for y* and x

```{r}
```

Solution:
```{r}
data$y_ = log(data$y)

ggplot(data=data, aes(x=x, y=y_)) +
  geom_point()

model <- lm(data=data, y_ ~ x)
summary(model)
```

# Exercise 2: Best-fit Line
Now we need to back-transform the data in order to plot the best-fit line on
the original (non-transformed) domain of y. 

***TODO: add some math to show the difference between original y, transformed y,
and the back-transformed relationship***

```{r}
```

Solution:
```{r}
#data$l = exp(model$coefficients[[1]] + x*model$coefficients[[2]] + model$residuals)
y_fitted = exp(model$coefficients[[1]] + x*model$coefficients[[2]] + model$residuals)
fitted = data.frame(x, y_fitted)

ggplot(data=data, aes(x=x, y=y)) +
  geom_point() +
  geom_line(data=fitted, aes(x=x, y=y_fitted))
  #geom_line(data=data, lm(l~x))
  #geom_abline(intercept=model$coefficients[[1]], slope=model$coefficients[[2]])
  #geom_scatter(data=fitted, aes(x=x, y=y_fitted))
```
